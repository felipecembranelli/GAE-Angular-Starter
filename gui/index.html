<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN""http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Tournament Server</title>
	<script src="_js/jquery-1.4.2.min.js" type="text/javascript"></script>
	<link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/static/main.css" type="text/css">  
  
      <script type "text/javascript">
      
    $(function () {
      	//alert("Starting");
    	//Get user name
		$.ajax({
      		type: "GET",
      		url: "../jsonapi/get_user",
      		dataType: 'json',
      		success: update_greeting,
      		timeout: 100
      	});
		
    	//Get tournament heats
		$.ajax({
      		type: "GET",
      		url: "../jsonapi/get_tournament_heats",
      		dataType: 'json',
      		success: update_tournament_heats,
      		timeout: 100
      	});
		
      });
    
    function update_greeting(data, status) {
       //alert("in function");
       key = "nickname";
  	   if (data.hasOwnProperty(key)){
    	  //alert ("Nickname = "+data[key]);
    	  $("#nickname").text("Welcome back "+data[key]);
  	   }
    }
    
    function update_tournament_heats(data, status) {
    	$.each(data, function(key, val)  {
            //alert(val.name);
    		$("<tr> <td> "+val.name+" </td></tr>").insertAfter("#tournament_heat_table");
          });
    	
        key = "nickname";
   	   if (data.hasOwnProperty(key)){
     	  //alert ("Nickname = "+data[key]);
     	  $("#nickname").text("Welcome back "+data[key]);
   	   }
     }
 
    </script>
  </head>
  <body>
	<div id="container">
    <div id="login">
      <br />

       <strong><p id="nickname"> </p></strong><a href="{{ sign_out }}">Sign out.</a>
<br>
      You are not signed in. <a class="rpxnow" onclick="return false;" href="https://pivotalexpert.rpxnow.com/openid/v2/signin?token_url={{domain_url}}/rpx.php"> Sign In </a>
      <br>
         </div><!-- end of #login -->

      
<table id="tournament_heat_table" class="design apps" cellspacing="0" width="900">
  <tr style="color:#00ce1d;font-weight:bold;text-align:center">
    <th>Tournament Heat</th><th>Finished</th><th>Edit</th><th>ID</th><th>Run</th><th>Result</th>
  </tr>

  <tr>
  	<td> {{th.name }} </td>
   
    <td align="center">
         {{th.finished}}
    </td>
	<td align="center">
	    <a href="/edit_tournament_heat/{{th.key.id}}/"> Edit </a>
    </td>
	<td align="center">
	    {{th.key.id}}
    </td>
    <td align="center">
        <a href="/run_tournament_heat/{{th.key.id}}/"> Run tournament heat </a>
    </td>
    <td align="center">
        {% if th.finished %}
        <a href="/view_heat_result/{{th.key.id}}/"> View heat result </a>
        {% endif %}
        
    </td>
    <td align="center">
    </td>

  </tr>


</table>
 
<br>
<a href="/add_tournament_heat"> Add a tournament heat </a> 
  
      
<table class="design apps" cellspacing="0" width="900">
  <tr style="color:#00ce1d;font-weight:bold;text-align:center">
    <th>App</th><th>TBD</th><th>TBD</th><th>TBD</th><th>TBD</th><th></th>
  </tr>
{% for app in apps %}

  <tr>
  	<td> {{app.name }} </td>
   
    <td align="center">
         {{app.url}}
    </td>
	<td align="center">
	    <a href="/edit_app/{{app.key.id}}/"> Edit </a>
    </td>
	<td align="center">
	    {{app.key.id}}
    </td>
    <td align="center">
        <a href="/check_app/{{app.key.id}}/"> Check </a>
    </td>
    <td align="center">
        <a href="/delete_app/{{app.key.id}}/"> Delete App </a>
    </td>

  </tr>
{% endfor %}

</table>
 
<br>
<a class="design addApp" href="/add_app"> Add an app </a><br>
<br>
<b>Available Bots:</b> <i> DEFAULT_TICTACTOE, DEFAULT_CENTERGRABTICTACTOE, DEFAULT_RANDOMTICTACTOE, DEFAULT_BOTTOMUPTICTACTOE <br> 
DEFAULT_HUNTERTICTACTOE, DEFAULT_INVALIDRETURNTICTACTOE, DEFAULT_LOOPBACKTICTACTOE</i>
<br>        
<table class="design players" cellspacing="0" width="900">
  <tr style="color:#00ce1d;font-weight:bold;text-align:center">
    <th>Course</th><th>TBD</th><th>TBD</th><th>TBD</th><th>TBD</th><th></th>
  </tr>
{% for course in courses %}

  <tr>
    <td align="center">
  	    {{course.name }} 
  	</td>
    <td align="center">
	    {{course.key.id}}
    </td>
	<td align="center">
	    <a href="/edit_course/{{course.key.id}}/"> Edit </a>
    </td>
    <td align="center">
    	<a href="/delete_course/{{course.key.id}}/"> Delete </a>
    </td>
    <td align="center">
    </td>

  </tr>
{% endfor %}

</table>
<br>
<a class="addCourse" href="/add_course"> Add a course </a> <br>

Debug info: <br> <br>
domain_url is {{domain_url}} <br>
user is {{user.nickname}} <br>
signout is {{sign_out}} <br>
is_admin is {{is_admin}} <br>
sign_in is {{sign_in}} <br>
page is {{page}} <br>
 

    <script type="text/javascript">
      var rpxJsHost = (("https:" == document.location.protocol) ? "https://" : "http://static.");
      document.write(unescape("%3Cscript src='" + rpxJsHost +
    "rpxnow.com/js/lib/rpx.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      RPXNOW.overlay = true;
      RPXNOW.language_preference = 'en';
    </script>
	</div><!-- end of #container -->
  </body>
</html>
